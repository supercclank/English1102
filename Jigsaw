<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>jQuery UI Draggable - Snap to element or grid</title>
  <link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
  <script src="http://code.jquery.com/jquery-1.9.1.js"></script>
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
  <link rel="stylesheet" href="/resources/demos/style.css">
  <style>

  .draggable { 
  	width: 150px; 
  	height: 150px; 
  	font-size: .9em;
  }

  .ui-widget-header p, .ui-widget-content p { 
  	margin: 0;  	
  	width : 150px;
  	height: 150px; }
  

  </style>

  <script>
  var numCorrect = 0;
  var numNeeded = 25;

  $(document).ready(
  	makePuzzle
  	);

  function makePuzzle(){
  	for(var x=0; x<5; x++){
  		$("#puzzleTable").append("<tr>");
		for(var y=0; y<5; y++){
				$("#puzzleTable tr:last").append("<td> <div id='draggable"+x+y+"' class='draggable ui-widget-content'> <img src='GameVase "+x+y+".jpg'> </div> </td>");
		  	}
		$("#puzzleTable").append("</tr>");
  	}

	for(var x=0; x<5; x++){
	  		$("#snapTargets").append("<tr>");
			for(var y=0; y<5; y++){
					$("#snapTargets tr:last").append("<td> <div id='snaptarget"+y+x+"' class='ui-widget-header'> <p>I'm a snap target</p> </div> </td>");
			  	}
			$("#snapTargets").append("</tr>");
	  	}

 }
  	 $(function() {

	$(".draggable").draggable({
	    snap: ".ui-widget-header", snapMode: "inner",
	     stop: function(event, ui) {
	    	    /* Get the possible snap targets: */
	    	// alert(this.id);
	        var snapped = $(this).data("ui-draggable").snapElements;
	        var id = $(this).children('img').attr("src");
	        // alert(id);
	        var xx = parseInt(id[9]);
	        var yy = parseInt(id[10]);
	        // alert(id);
	        // alert(snapped);
	        var x1 = xx - 1;
	        var y1 = yy - 1;
	        var x2 = xx + 1;
	        var y2 = yy + 1;
	        var bool = true;
	    //      Pull out only the snap targets that are "snapping": 
	         var snappedTo = $.map(snapped, function(element) {
	         	// alert(snapped);
	             return element.snapping ? element.item : null;
	         });
	         var snappedToIds = [];
	       for (var x=0; x<snappedTo.length; x++){
	       		snappedToIds.push(snappedTo[x].id);
	       }
	       
	       if(bool){
	       		if(snappedToIds.indexOf("snaptarget"+xx+yy)>-1){
	       			// alert("AA");
	       			var positionOther = $("#snaptarget"+xx+yy).offset();
	       			var otherLeft = positionOther.left;
	       			var otherTop = positionOther.top;
					var positionThis = $(this).offset();
					var thisLeft = positionThis.left;
					var thisTop = positionThis.top;
					// alert(otherLeft);
					// alert(otherTop);
					// alert(thisLeft);
					// alert(thisTop);
					// alert("dd");
					// alert(thisTop!=otherTop||thisLeft!=otherLeft);

	       		// alert("the bool is "+bool);
	       			if(thisTop!=otherTop||thisLeft!=otherLeft){
	       				// alert("aa");
	       				bool = false;
	       			}

	       		// alert("the bool is "+bool);
	       			// alert("daheck");
	       		}
	       		else {
	       			// alert("deHeck2");
	       			bool = false;
	       		}
	       }
	       		// alert("the bool is "+bool);
		       if(bool){		
		    	   // alert("wooh");
		    	   $("#"+this.id).draggable("destroy");
		    	  	numCorrect++;
		    	  	// alert(numCorrect);
		    	  	// alert(numNeeded);
		    	  	// alert(numCorrect==numNeeded);
		    	  	// alert("q");
		    	  	if (numCorrect==numNeeded){
		    	  		alert("fin!");
		    	  	}
		   		}
	    }
	         });
	
	     
	});

  
  </script>
</head>
<body>
  
<br style="clear:both">
<table id='snapTargets' class='pTable' border="0px" cellspacing="0px">
	</table>

 <table id='puzzleTable' class='pTable' border="0px" cellspacing="0px">
	</table>

</body>
</html>
